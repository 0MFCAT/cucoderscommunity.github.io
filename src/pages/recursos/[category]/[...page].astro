---
import ResourcesLayout from "../../../layouts/resourcesLayout.astro";
import categories from "../../../data/resourcesCategories.json";
import Pagination from "../../../components/pagination.astro";
import { getCollection } from "astro:content";

export async function getStaticPaths({ paginate }) {
  let allCategories = [];
  for (const key in categories) {
    if (categories[key].isParent) {
      for (const item in categories[key].items) {
        allCategories.push({ key: categories[key].items[item].id, slug: categories[key].items[item].slug });
      }
    } else {
      allCategories.push({ key: categories[key].id, slug: categories[key].slug });
    }
  }

  const allResources = await getCollection("resources");
  return allCategories.map((categoryObj) => {
    let filteredResources = allResources.filter((resource) => resource.data.category == categoryObj.key);
    const category = categoryObj.slug;
    return paginate(filteredResources, {
      params: { category },
      pageSize: 25,
    });
  });
}
const { page } = Astro.props;
const params = Astro.params;
---

<ResourcesLayout title={params.category}>
  {page.data.length == 0 && <img src="/assets/img/emptyList.webp" class="w-ful mx-auto my-4" />}
  {page.data.map((resource) => <div>{resource.slug} </div>)}
  <Pagination prev={page.url.prev} next={page.url.next} />
</ResourcesLayout>
